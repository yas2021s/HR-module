$(document).ready(function(){
	//general for forms
	//$(':input').css('min-width','90px');
$(':input').not('.btn, .navbar-toggle, .no-alert').css('min-width','90px');
	//$('form select').chosen({ allow_single_deselect:true});
	$('form select').chosen();
});
jQuery(function($) {
	$('#dataTables').find('thead tr th:first').css({'min-width': '35px'});
	//initiate dataTables plugin
	var dataTable = $('#dataTables').dataTable({
		"pageLength": 20,
		"lengthMenu": [[10, 20, 50, -1], [10, 20, 50, "All"]],
		"aoColumnDefs": [ {
			"bSortable": false,
			"aTargets": [ "no-sort" ]
		} ],
		"scrollX":true,
		"language": {
				  "info": "<strong>_START_</strong>–<strong>_END_</strong> of <strong>_TOTAL_</strong>",
				  "infoFiltered":"",
				  "infoEmpty":"",
				  "paginate": {
						"first": "First",
						"last": "Last",
						"next": "Next",
						"previous": "Previous",
					  }
				}
	});        
	//reporting table
	$('#reportTable').dataTable( {
		"paging": false,
		"searching": false,
		"scrollY": 400,
		"scrollX": "100%",
		"sort": false,
		"info": false,
		"autoWidth": false,
		"fnInitComplete": function() {
			var table_header,
			_this = this;
			table_header = $('.dataTables_scrollHeadInner').css('position', 'relative');
			$('body').find('.dataTables_scrollBody').each(function(){ 
				$(this).bind('jsp-scroll-x', function(event, scrollPositionX, isAtLeft, isAtRight){
					table_header.css('right', scrollPositionX);
				}).jScrollPane({
					showArrows: false,
					animateScroll: true,
					animateDuration: 200,
					mouseWheelSpeed: 200,
					keyboardSpeed: 120,
					/* This next parameter is new to jScrollpane-custom */
					animateSteps: true
				});
			});
		}
	});

	//CS table
	$('#csTable').dataTable( {
		"paging": false,
		"searching": false,
		"scrollY": 200,
		"scrollX": "90%",
		"sort": false,
		"info": false,
		"autoWidth": false,
		"fnInitComplete": function() {
			var table_header,
			_this = this;
			table_header = $('.dataTables_scrollHeadInner').css('position', 'relative');
			$('body').find('.dataTables_scrollBody').each(function(){ 
				$(this).bind('jsp-scroll-x', function(event, scrollPositionX, isAtLeft, isAtRight){
					table_header.css('right', scrollPositionX);
				}).jScrollPane({
					showArrows: false,
					animateScroll: true,
					animateDuration: 200,
					mouseWheelSpeed: 200,
					keyboardSpeed: 120,
					/* This next parameter is new to jScrollpane-custom */
					animateSteps: true
				});
			});
		}
	});
	
	//CS table
	$('#csTable1').dataTable( {
		"paging": false,
		"searching": false,
		"scrollY": 200,
		"scrollX": "90%",
		"sort": false,
		"info": false,
		"autoWidth": false,
		"fnInitComplete": function() {
			var table_header,
			_this = this;
			table_header = $('.dataTables_scrollHeadInner').css('position', 'relative');
			$('body').find('.dataTables_scrollBody').each(function(){ 
				$(this).bind('jsp-scroll-x', function(event, scrollPositionX, isAtLeft, isAtRight){
					table_header.css('right', scrollPositionX);
				}).jScrollPane({
					showArrows: false,
					animateScroll: true,
					animateDuration: 200,
					mouseWheelSpeed: 200,
					keyboardSpeed: 120,
					/* This next parameter is new to jScrollpane-custom */
					animateSteps: true
				});
			});
		}
	});
	
	//TableTools settings
	TableTools.classes.container = "btn-group btn-overlap";	
	TableTools.classes.print = {
		"body": "DTTT_Print",
		"info": "tableTools-alert gritter-item-wrapper gritter-info gritter-center white",
		"message": "tableTools-print-navbar"
	}	
	if($("#dataTables").length > 0) {
		var value = window.location.href;
		var swfpath;
		count = value.split("/").length - 1;
        switch(count){
		    case 5 :  swfpath = "swf/copy_csv_xls_pdf.swf"; break;
            case 6 :  swfpath = "../swf/copy_csv_xls_pdf.swf"; break;
			case 7 :  swfpath = "../../swf/copy_csv_xls_pdf.swf"; break;
			case 8 :  swfpath = "../../../swf/copy_csv_xls_pdf.swf"; break;
		}	
		var tableTools_obj = new $.fn.dataTable.TableTools( dataTable, {
			"sSwfPath": swfpath,			
			"sRowSelector": "td:not(:last-child)",
			"sRowSelect": "multi",
			"fnRowSelected": function(row) {
				try { $(row).find('input[type=checkbox]').get(0).checked = true }
				catch(e) {}
			},
			"fnRowDeselected": function(row) {
				try { $(row).find('input[type=checkbox]').get(0).checked = false }
				catch(e) {}
			},
			"sSelectedClass": "success",
			"aButtons": [
				{
					"sExtends": "xls",
					"sToolTip": "Export to XLS",
					"sButtonClass": "btn btn-white btn-primary  btn-bold",
					"sButtonText": "<i class='fa fa-file-excel-o bigger-110 green'></i>",
					"mColumns": function ( dtSettings ) {
									var api = new $.fn.dataTable.Api( dtSettings );
									return api.columns(":not(:last)").indexes().toArray();
								}
				},
			]
		} );
		$(tableTools_obj.fnContainer()).appendTo($('.tableTools-container'));		
		setTimeout(function() {
			$(tableTools_obj.fnContainer()).find('a.DTTT_button').each(function() {
				var div = $(this).find('> div');
				if(div.length > 0) div.tooltip({container: 'body'});
				else $(this).tooltip({container: 'body'});
			});
		}, 200);
		var colvis = new $.fn.dataTable.ColVis( dataTable, {
			"buttonText": "<i class='fa fa-search'></i>",
			"aiExclude": [0],
			"bShowAll": true,
			//"bRestore": true,
			"sAlign": "right",
			"fnLabel": function(i, title, th) {
				return $(th).text();//remove icons, etc
			}
			
		}); 		
		//style it
		$(colvis.button()).addClass('btn-group').find('button').addClass('btn btn-white btn-info btn-bold')
		//and append it to our table tools btn-group, also add tooltip
		$(colvis.button())
		.prependTo('.tableTools-container .btn-group')
		.attr('title', 'Show/hide columns').tooltip({container: 'body'});
		
		//and make the list, buttons and checkboxed Ace-like
		$(colvis.dom.collection)
		.addClass('dropdown-menu dropdown-light dropdown-caret dropdown-caret-right')
		.find('li').wrapInner('<a href="javascript:void(0)" />') //'A' tag is required for better styling
		.find('input[type=checkbox]').addClass('ace').next().addClass('lbl padding-8');
	}
	/////////////////////////////////
	//table checkboxes
	//$('th input[type=checkbox], td input[type=checkbox]').prop('checked', false);
	
	/********************************/
	//add tooltip for small view action buttons in dropdown menu
	$('[data-rel="tooltip"]').tooltip({placement: tooltip_placement});	
	//tooltip placement on right or left
	function tooltip_placement(context, source) {
		var $source = $(source);
		var $parent = $source.closest('table')
		var off1 = $parent.offset();
		var w1 = $parent.width();

		var off2 = $source.offset();

		if( parseInt(off2.left) < parseInt(off1.left) + parseInt(w1 / 2) ) return 'right';
		return 'left';
	};	
	//Image upload 
	$('#uploadimage').ace_file_input({
		no_file:'No File ...',
		btn_choose:'Choose',
		btn_change:'Change',
		droppable:false,
		onchange:null,
		thumbnail: 'small',
		whitelist:'gif|png|jpg|jpeg',
		//blacklist:'exe|php'
		//onchange:''
	});
	//file upload 
	$('#uploadfile').ace_file_input({
		no_file:'No File ...',
		btn_choose:'Choose',
		btn_change:'Change',
		droppable:false,
		onchange:null,
		thumbnail: 'small',
		whitelist:'doc|docx|pdf',
		//blacklist:'exe|php'
		//onchange:''
	});		
	$('#uploadimage_drag_drop').ace_file_input({
		style:'well',
		btn_choose:'Drop Image here or click to choose',
		btn_change:null,
		no_icon:'ace-icon fa fa-cloud-upload',
		droppable:true,
		thumbnail:'fit',//large | small
		whitelist:"jpeg|jpg|png|gif",
		preview_error : function(filename, error_code) {		}
	});
	
	//for modal
	$('body').on('hidden.bs.modal', '.modal', function () {
        $(this).removeData('bs.modal');
    });    
    //tooltip
	$('[data-tooltip="tooltip"]').tooltip()
	//Date range picker
	$('.input-daterange').datepicker({autoclose: true});
	
	// chosen read only	
	var select = $('form select');
	select.each( function(){
		$(this).on('chosen:updated', function () {
			if ($(this).attr('readonly')) { 
				var wasDisabled = select.is(':disabled'); 
				$(this).attr('disabled', 'disabled'); 
				$(this).data('chosen').search_field_disabled(); 
				if (wasDisabled) { 
					$(this).attr('disabled', 'disabled'); 
				} else { 
					$(this).removeAttr('disabled'); 
				} 
			} 
		}); 
	}); 
	select.trigger('chosen:updated');
	
	//jscrollpane div
	$('#jscroll_div').jScrollPane();

	$('a[onclick]').each(function(){$(this).onclick=null});

	/*$('a.btn').not('.btn-scroll-up, .no-alert').click(function(event){
		var action = $('a[onclick]').attr('onclick');
		if($(this).attr('data-toggle') != 'modal'){
			var result =confirm('Are you sure, you want to continue.');
			if(result==true){
				$('a[onclick]')[0].onclick=action;
			}else{
				event.preventDefault();
			}
		}
	});*/
	
});
